<!DOCTYPE html>
<html>
<head>
	<title>WebGL Playground</title>
	<link rel="stylesheet" type="text/css" href="style.css">
	<script src="gl.js"></script>
	<script src="Shaders.js"></script>
	<script src="RenderLoop.js"></script>
	<script>
		var gl,
			gVertCount = 0,
			uPointSizeLoc = -1,
			uAngle = 0,
			uRadius = 0,
			gRLoop;

		window.addEventListener("load", function(){
			gl= GLInstance("glcanvas"); // Init context
			gl.fSetSize(500,500); //Setting size
			gl.fClear(); //Reseting context

			//Shader steps
			// Get shaders texts
			/*var vShaderTxt = ShaderUtil.domShaderSrc("vertex_shader"), 
				fShaderTxt = ShaderUtil.domShaderSrc("fragment_shader"),

				//Compile shaders
				vShader = ShaderUtil.createShader(gl,vShaderTxt,gl.VERTEX_SHADER),
				fShader = ShaderUtil.createShader(gl,fShaderTxt, gl.FRAGMENT_SHADER),

				//Link shaders into program
				shaderProg = ShaderUtil.createProgram(gl,vShader,fShader,true);*/
				shaderProg = ShaderUtil.domShaderProgram(gl,"vertex_shader", "fragment_shader", true);

			gl.useProgram(shaderProg);
			var aPositionLoc = gl.getAttribLocation(shaderProg,"a_position");
			uAngle = gl.getUniformLocation(shaderProg,"uAngle");
			uRadius = gl.getUniformLocation(shaderProg,"uRadius");
			uPointSizeLoc = gl.getUniformLocation(shaderProg,"uPointSize");
			gl.useProgram(null);

			//data buffer setup
			var aryVerts = new Float32Array([0,0,0]),
				bufVerts = gl.fCreateArrayBuffer(aryVerts);

			gVertCount = aryVerts.length / 3;
			
			gl.useProgram(shaderProg);				
			gl.bindBuffer(gl.ARRAY_BUFFER,bufVerts);				
			gl.enableVertexAttribArray(aPositionLoc);				
			gl.vertexAttribPointer(aPositionLoc,3,gl.FLOAT,false,0,0);
			gl.bindBuffer(gl.ARRAY_BUFFER,null);					
			RLoop = new RenderLoop(onRender).start();
		});

		var gPointSize = 0;
			gPSizeStep = 3,
			gAngle = 0,
			gAngleStep = (Math.PI / 180.0) * 90,
			gRadius = 0,
			gRadiusStep = 0.1;

		var growing = true;
		function onRender(dt){
			gPointSize += gPSizeStep * dt;
			var size = (Math.sin(gPointSize)*10.0)+20;
			gl.uniform1f(uPointSizeLoc,size);

			gAngle += gAngleStep *dt;
			gl.uniform1f(uAngle,gAngle);

			gRadius += gRadiusStep * dt;
			gl.uniform1f(uRadius,Math.sin(gRadius));

			gl.fClear();
			gl.drawArrays(gl.POINTS, 0, gVertCount)
		}
	</script>
</head>
<body>
	<div>
		<canvas id="glcanvas"></canvas>
	</div>
	<script id="vertex_shader" type="x-shader/x-vertex">#version 300 es
		in vec3 a_position;
		
		uniform float uPointSize;
		uniform float uAngle;
		uniform float uRadius;

		void main(void){
			gl_PointSize = uPointSize;
			gl_Position = vec4(cos(uAngle) *uRadius + a_position.x,
			sin(uAngle) * uRadius + a_position.y,
			a_position.z,
			1.0);
		}
	</script>
	<script id="fragment_shader" type="x-shader/x-fragment">#version 300 es
		precision mediump float;

		out vec4 finalColor;
		
		void main(void) {
			finalColor = vec4(0.0, 0.0, 0.0, 1.0);
		}
	</script>
</body>
</html>